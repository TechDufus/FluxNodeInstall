---
- name: Create .flux dir if it doesn't exist
  ansible.builtin.file:
    path: "{{ daemon.path }}"
    mode: "0775"
    state: directory
    owner: "{{ global.user }}"
    group: "{{ global.user }}"

- name: Starting Bootstrap Download
  ansible.builtin.debug:
    msg: Starting bootstrap download, which will take a while.
  run_once: true

- name: Download and unpack bootstrap
  ansible.builtin.unarchive:
    remote_src: true
    src: "{{ daemon.bootstrap_url }}"
    dest: "{{ daemon.path }}"
    mode: "0644"
    owner: "{{ global.user }}"
    group: "{{ global.user }}"

- name: User Perms
  ansible.builtin.file:
    dest: /home/{{ global.user }}
    state: directory
    recurse: true
    owner: "{{ global.user }}"
    group: "{{ global.user }}"

- name: Verify Executible Block Perms
  ansible.builtin.file:
    dest: "{{ item }}"
    mode: "0700"
    state: directory
    owner: "{{ global.user }}"
    group: "{{ global.user }}"
  with_items:
    - "{{ daemon.path }}/blocks"
    - "{{ daemon.path }}/blocks/index"
    - "{{ daemon.path }}/chainstate"
    - "{{ daemon.path }}/database"
    - "{{ daemon.path }}/determ_zelnodes"
